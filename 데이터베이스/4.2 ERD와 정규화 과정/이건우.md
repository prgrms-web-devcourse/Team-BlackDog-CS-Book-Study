데이터베이스를 잘못 설계하면 이상 현상이 생긴다. 

이상 현상을 제거하면서 데이터베이스를 설계하는 과정을 정규화이다.

## 이상 현상의 종류

| 멘토 | 이름 | 스터디 |
| --- | --- | --- |
| 흑구 | 건우 | cs |
| 흑구 | 건우 | 디자인 패턴 |
| 흑구 | 기서 | cs |

기본 키 속성은(멘토, 이름)이다.

### 삽입 이상

릴레이션에 새 데이터를 삽입하기 위해 원치 않는 불필요한 데이터도 함께 삽입해야 하는 문제이다.

새로운 데브 코스 일원이 생겨 데이터를 삽입한다. 

아직 멘토가 배정되지 않았지만 기본 키 속성 중 멘토가 있기 때문에 임시 멘토를 배정해야 하므로 삽입 이상이 생긴다.

### 갱신 이상

중복된 튜플중 일부만 수정하여 데이터가 불일치하게 되는 문제이다.

건우의 멘토가 흑구에서 → 에프로 변경되었다.

건우에 대한 튜플이 2개가 존재하여 2개의 멘토를 변경해야 하지만 1개만 변경되면 서로 다른 멘토를 가지는 모순이 생긴다.

### 삭제 이상

튜플을 삭제하면서 필요한 데이터까지 같이 삭제되는 문제이다.

기서가 cs 스터디를 그만둬 튜플을 삭제하면 기서의 멘토와 이름 데이터까지 삭제되어 원치 않는 손실을 하게 된다.

## 함수 종속

어떠한 튜플에서 속성 X의 값이 하나로 정해지고 그에 따라 Y 값이 항상 하나면 

Y가 X에 종속되어 있다고 한다.

X를 결정자 Y를 종속자라고 하며, X → Y 로 표현한다.

| 주민번호  | 이름 | 성별 |
| --- | --- | --- |
| 980215-1234567 | 이건우 | 남 |

 주민번호 값이 정해지면 이름과 성별은 하나의 값으로 대응된다.

이름 속성과 성별 속성이 주민번호 속성에 종속되어 있으며, 주민번호가 결정자, 이름과 성별이 종속자가 된다.

결정자는 속성 집합이 될 수도 있다.

| 이름 | 스터디 | 참여여부 |
| --- | --- | --- |
| 이건우 | cs | Y |

참여 여부가 (이름, 스터디)에 종속되어있다. 

### 완전 함수 종속

종속자 Y가 결정자 X의 모든 속성에 종속된 것을 말한다.

결정자가 단일 속성이면 종속자 Y는 당연하게 완전 함수 종속이다.

결정자가 속성 집합일 경우 일부분에 만 종속될 수 있다.

| 수강생 아이디 | 스터디 아이디 | 수강생 이름 | 스터디 참여 여부 |
| --- | --- | --- | --- |
| gw0215 | S1 | 이건우 | Y |

기본 키 속성 집합 (수강생 아이디, 스터디 아이디)에서 스터디 참여 여부는 속성 집합 전체에 종속되어 있다.

### 부분 함수 종속

기본 키 속성 집합(수강생 아이디, 스터디 아이디)에서 수강생 이름은 속성 집합 중 수강생 아이디에만 종속되어 있다. 

 

## 정규화

함수 종속성을 이용하여 릴레이션을 연관성이 있는 속성들로만 구성되도록 분리해서 이상 현상을 발생하지 않는 릴레이션을 만들어가는 과정

## 제1정규형

릴레이션에 속한 모든 속성이 도메인이 원자 값으로만 구성되어야 한다.

| 수강생 | 스터디 | 멘토 | 서브멘토 | 스터디 참여 |
| --- | --- | --- | --- | --- |
| 건우 | cs, 디자인 패턴 | 흑구 | 현웅 | Y,N |
| 영지 | cs, 발표 | 흑구 | 현웅 | Y,Y |
| 영수 | cs | 흑구 | 현웅 | N |

수강생이 다중 값 속성을 가지고 있어 제1정규형 제약조건을 만족하지 못한다.

| 수강생 | 스터디 | 멘토 | 서브멘토 | 스터디 참여 |
| --- | --- | --- | --- | --- |
| 건우 | cs | 흑구 | 현웅 | Y |
| 건우 | 디자인 패턴 | 흑구 | 현웅 | N |
| 영지 | cs | 흑구 | 현웅 | Y |
| 영지 | 발표 | 흑구 | 현웅 | Y |
| 영수 | cs | 흑구 | 현웅 | N |

모든 속성이 원자 값을 가져 제1정규형을 만족한다.

## 제1정규형의 문제점

제 1정규형은 이상 현상이 발생할 수 있다.

### 삽입 이상

기서라는 새 수강생이 들어왔다고 하자

기서는 새로 들어와 아직 스터디가 없다.

기본 키 가(수강생, 스터디)라고 할때 기서의 데이터를 삽입할 수가 없다.

| 수강생 | 스터디 | 멘토 | 서브멘토 | 스터디 참여 |
| --- | --- | --- | --- | --- |
| 기서 | null | 흑구 | 현웅 | null |

### 갱신 이상

건우의 멘토가 흑구에서 → 에프로 변경되었다.

일부 튜플의 멘토 속성값만 변경하면 데이터의 일관성을 유지할 수 없다.

| 수강생 | 스터디 | 멘토 | 서브멘토 | 스터디 참여 |
| --- | --- | --- | --- | --- |
| 건우 | cs | 에프 | 수빈 | Y |
| 건우 | 디자인 패턴 | 흑구 | 현웅 | N |

### 삭제 이상

영수가 cs 스터디를 그만둬 투플을 삭제하게 되었다.

투플을 삭제하면 스터디와 관련 없는 데이터 수강생과 멘토 정보도 삭제되어 버린다.

## 제2정규형

릴레이션이 제 1정규형에 속하고, 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속되면 제2정규형 이라 한다.

스터디 릴레이션은 기본키인 수강생, 스터디에 완전 함수 종속되지 않은 멘토 가 존재한다.

멘토가 스터디와 같은 릴레이션에 존재하지 않고 2개의 릴레이션으로 분해하면 수강생 릴레이션과 스터디 릴리에션은 모두 제 2정규형에 속하게 된다.

| 수강생 | 스터디 | 스터디 참여 |
| --- | --- | --- |
| 건우 | cs | Y |
| 건우 | 디자인 패턴 | N |

| 수강생 | 멘토 | 서브멘토 |
| --- | --- | --- |
| 건우 | 흑구 | 현웅 |

릴레이션을 분해할때 주의할점은 조인을 하여 다시 분해전으로 복원할 수 있어야 한다.

이러한 분해를 무손실 분해라고 한다.

## 제2정규형의 문제점

스터디 릴레이션은 단 한 개의 종속성만 있다.

(수강생, 스터디)에 따라 스터디 참여 값이 결정된다.

하지만 수강생 릴레이션은 종속성이 여러 개 존재한다.

### 삽입 이상

새로운 멘토와 서브 멘토 데이터가 생겼지만 기본 키인 수강생이 없으면 삽입할 수 없다.

| 수강생 | 멘토 | 서브멘토 |
| --- | --- | --- |
| 건우 | 흑구 | 현웅 |
| null | 에프 | 수빈 |

### 갱신 이상

멘토의 서브 멘토가 변경되면 모든 튜플에서 서브 멘토 값을 변경하여야 한다.

만약 일부 튜플만 변경하면 데이터 불일치 문제가 생긴다.

| 수강생 | 멘토 | 서브멘토 |
| --- | --- | --- |
| 건우 | 흑구 | 현웅 |
| 기서 | 흑구 | 찬미 |

### 삭제 이상

수강생이 중도 하차를 하여 데이터를 삭제하면 멘토와 서브 멘토 데이터까지 삭제된다.

## 제3정규형

릴레이션이 제2 정규형이고 기본 키가 아닌 모든 속성이 기본 키에 이행적 함수 종속이 되지 않는다.

### 이행적 함수 종속

릴레이션을 구성하는 3개의 속성 집합 X, Y, Z에 대해 함수 종속 관계 X → Y,  Y → Z가 존재하면 X → Z가 성립한다.

이때 속성 Z가 속성 X에 대해 이행적으로 함수 종속되었다고 한다.

수강생이 기본 키이므로 멘토와 서브 멘토가 함수적으로 종속된다.

수강생이 멘토를 결정하고 멘토가 서브 멘토를 결정하는 이행적 함수 종속관계도 존재한다.

이러한 릴레이션을 분해하기 위해 X,Y의 속성집합 릴레이션과 Y,Z속성집합 릴레이션으로 분해해야 한다.

| 수강생 | 멘토 |
| --- | --- |
| 건우 | 흑구 |
| 주영 | 에프 |

| 멘토 | 서브멘토 |
| --- | --- |
| 흑구 | 현웅 |
| 에프 | 수빈 |

### 보이스 코드 정규형

릴레이션의 함수 종속 관계에서 모든 결정자가 후보 키이면 보이스/코드 정규형이다.

지금까지의 릴레이션들은 후보 키가 하나밖에 없어서 그걸 기본 키로 선정하였다.

하지만 여러 개의 후보 키가 존재할 수 있다.

후보 키를 여러 개 가지면 이상 현상이 발생할 수 있고 이러한 현상을 해결하기 위해 보이스/코드 정규형이다.

| 고객 이름 | 음식 | 요리사 |
| --- | --- | --- |
| 건우 | 짜장면 | 이연복 |
| 성준 | 짜장면 | 이연복 |
| 선호 | 짜장면 | 백종원 |
| 주영 | 초밥 | 고든램지 |
| 예원 | 우동 | 육식맨 |

### 전제 조건

고객은 동일한 음식을 주문할 수 없다.

고객은 여러 개의 음식을 주문할 수 있다.

음식은 여러 명의 요리사가 담당할 수 있다.

요리사는 하나의 음식만 담당한다.

후보 키로는 (고객이름,음식)과 (고객이름, 요리사)가있다.

(고객 이름, 음식)을 기본 키로 선정해 보자

음식 주문 릴레이션은 모든 속성이 원자 값이어서 제1 정규형에 만족한다.

요리사는 기본 키에 완전 함수 종속 없어 제2정규형에 만족한다.

이행적 함수 종속이 없어 제3정규형에 만족한다.

### 삽입 이상

제이미 올리버가 신메뉴로 파스타를 추가했으나 고객이 없으면 릴레이션에 삽입할 수 없다.

| 고객 이름 | 음식 | 요리사 |
| --- | --- | --- |
| 건우 | 짜장면 | 이연복 |
| 성준 | 짜장면 | 이연복 |
| 선호 | 짜장면 | 백종원 |
| 주영 | 초밥 | 고든램지 |
| 예원 | 우동 | 육식맨 |
| null | 파스타 | 제이미 올리버 |

### 갱신 이상

이연복이 짜장면을 그만 만들고 탕수육으로 메뉴를 교체하면 모두 동일하게 변경되어야 한다.

만약 1개만 변경되면 요리사는 하나의 음식만 담당한다는 조건을 지키지 못한다.

| 고객 이름 | 음식 | 요리사 |
| --- | --- | --- |
| 건우 | 짜장면 | 이연복 |
| 성준 | 탕수육 | 이연복 |
| 선호 | 짜장면 | 백종원 |
| 주영 | 초밥 | 고든램지 |
| 예원 | 우동 | 육식맨 |

### 삭제 이상

주영이가 초밥이 먹기 싫어 초밥 주문을 취소하면 고든 램지가 초밥을 담당한다는 정보도 함께 삭제된다.

이상 현상이 발생하지 않도록 모든 결정자가 후보 키가 될 수 있도록 릴레이션을 분해해야 한다.

| 고객  | 요리사 |
| --- | --- |
| 건우 | 이연복 |
| 주영 | 고든램지 |
| 선호 | 백종원 |

| 요리사 | 요리 |
| --- | --- |
| 이연복 | 짜장면 |
| 고든램지 | 초밥 |
| 백종원 | 짜장면 |
